<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Our Memories Together</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Inter:wght@200;300;400;500;600&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="styles.css">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <style>
    /* Upload-specific styles */
    .upload-section {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 1000;
    }

    .upload-btn {
      background: rgba(255, 255, 255, .10);
      backdrop-filter: blur(20px);
      color: var(--text);
      border: 1px solid var(--line);
      padding: 16px 32px;
      border-radius: 50px;
      font-size: .9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all .3s;
      box-shadow: var(--shadow);
      font-family: 'Inter', sans-serif;
      letter-spacing: 0.02em;
    }

    .upload-btn:hover {
      transform: translateY(-2px);
      background: rgba(255, 255, 255, .14);
      border-color: rgba(255, 255, 255, .20);
      box-shadow: 0 24px 70px rgba(0, 0, 0, .65);
    }

    #photoInput {
      display: none;
    }

    .drawing-section {
      margin-top: 60px;
      width: 100%;
    }

    .drawing-section h2 {
      text-align: center;
      margin-bottom: 40px;
    }

    .canvas-container {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
    }

    #drawingCanvas {
      border: 1px solid var(--line);
      border-radius: var(--radius);
      cursor: crosshair;
      background: var(--panel);
      box-shadow: var(--shadow);
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      align-items: center;
      padding: 25px;
      background: var(--panel);
      border-radius: var(--radius);
      border: 1px solid var(--line);
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }

    .controls label {
      font-weight: 400;
      color: var(--text);
      font-size: .9rem;
    }

    .controls input[type="color"],
    .controls input[type="range"] {
      cursor: pointer;
    }

    .controls button {
      background: rgba(255, 255, 255, .10);
      color: var(--text);
      border: 1px solid var(--line);
      padding: 10px 20px;
      border-radius: 12px;
      font-size: .9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all .3s;
    }

    .controls button:hover {
      background: rgba(255, 255, 255, .14);
      border-color: rgba(255, 255, 255, .20);
      transform: translateY(-1px);
    }

    .controls button.danger {
      background: rgba(239, 68, 68, 0.15);
      border-color: rgba(239, 68, 68, 0.3);
    }

    .controls button.danger:hover {
      background: rgba(239, 68, 68, 0.25);
      border-color: rgba(239, 68, 68, 0.5);
    }

    .no-photos {
      text-align: center;
      padding: 90px 20px;
      color: var(--muted);
      font-size: 1.05rem;
      letter-spacing: .12em;
      text-transform: uppercase;
    }

    /* accessibility */
    @media (prefers-reduced-motion: reduce) {
      .scroll-indicator {
        animation: none;
      }

      .photo-item {
        transition: none;
      }

      .photo-item img {
        transition: none;
      }
    }

    /* mobile */
    @media (max-width: 768px) {
      .container {
        padding: 40px 16px;
      }

      .photos-gallery {
        gap: 56px;
        padding: 56px 0 100px;
      }

      #drawingCanvas {
        max-width: 100%;
      }

      .upload-section {
        bottom: 20px;
        right: 20px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Hero Section -->
    <div class="hero-section">
      <h1>Our Memories Together</h1>
      <div class="scroll-indicator">â†“ SCROLL â†“</div>
    </div>

    <!-- Photos Gallery -->
    <div class="photos-gallery" id="photosGallery">
      <!-- Photos will be inserted here -->
    </div>

    <!-- Upload Button -->
    <div class="upload-section">
      <input type="file" id="photoInput" accept="image/*" multiple>
      <button class="upload-btn" onclick="document.getElementById('photoInput').click()">ðŸ“¸ Add Photos</button>
    </div>

    <!-- Drawing Section -->
    <div class="drawing-section">
      <h2>Express What's in Your Heart</h2>

      <div class="controls">
        <label for="colorPicker">Color:</label>
        <input type="color" id="colorPicker" value="#ffffff">

        <label for="brushSize">Brush Size:</label>
        <input type="range" id="brushSize" min="1" max="50" value="5">
        <span id="sizeDisplay">5px</span>

        <button id="clearBtn" class="danger">Clear Canvas</button>
        <button id="saveBtn">Save Drawing</button>
        <button id="eraserBtn">Eraser</button>
      </div>

      <div class="canvas-container">
        <canvas id="drawingCanvas" width="800" height="600"></canvas>
      </div>
    </div>
  </div>

  <script>
    // Canvas Setup
    const canvas = document.getElementById('drawingCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let currentColor = '#ffffff';
    let brushSize = 5;
    let isEraser = false;

    // Drawing Functions
    function startDrawing(e) {
      isDrawing = true;
      draw(e);
    }

    function stopDrawing() {
      isDrawing = false;
      ctx.beginPath();
    }

    function draw(e) {
      if (!isDrawing) return;

      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      ctx.lineWidth = brushSize;
      ctx.lineCap = 'round';
      ctx.strokeStyle = isEraser ? '#ffffff' : currentColor;

      ctx.lineTo(x, y);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(x, y);
    }

    // Event Listeners for Drawing
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseout', stopDrawing);

    // Touch support for mobile
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      const mouseEvent = new MouseEvent('mousedown', {
        clientX: touch.clientX,
        clientY: touch.clientY
      });
      canvas.dispatchEvent(mouseEvent);
    });

    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      const mouseEvent = new MouseEvent('mousemove', {
        clientX: touch.clientX,
        clientY: touch.clientY
      });
      canvas.dispatchEvent(mouseEvent);
    });

    canvas.addEventListener('touchend', (e) => {
      e.preventDefault();
      const mouseEvent = new MouseEvent('mouseup', {});
      canvas.dispatchEvent(mouseEvent);
    });

    // Color Picker
    document.getElementById('colorPicker').addEventListener('change', (e) => {
      currentColor = e.target.value;
      isEraser = false;
    });

    // Brush Size
    document.getElementById('brushSize').addEventListener('input', (e) => {
      brushSize = e.target.value;
      document.getElementById('sizeDisplay').textContent = brushSize + 'px';
    });

    // Clear Canvas
    document.getElementById('clearBtn').addEventListener('click', () => {
      if (confirm('Are you sure you want to clear the canvas?')) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    });

    // Eraser
    document.getElementById('eraserBtn').addEventListener('click', () => {
      isEraser = !isEraser;
      const btn = document.getElementById('eraserBtn');
      btn.style.background = isEraser ? 'rgba(251, 191, 36, 0.4)' : 'rgba(139, 92, 246, 0.3)';
      btn.textContent = isEraser ? 'Drawing Mode' : 'Eraser';
    });

    // Save Drawing
    document.getElementById('saveBtn').addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'my-message.png';
      link.href = canvas.toDataURL();
      link.click();
    });

    // Photo Upload Handling
    let photos = [];
    let currentPhotoIndex = 0;
    let slideshowInterval = null;
    let slideshowSpeed = 2000; // milliseconds
    let isPlaying = false;

    // Handle file selection from input
    document.getElementById('photoInput').addEventListener('change', (e) => {
      const files = e.target.files;
      const photosSection = document.getElementById('photosSection');

      // Clear existing photos
      photosSection.innerHTML = '';
      photos = [];

      // Load all photos
      let loadedCount = 0;
      const totalFiles = files.length;

      for (let file of files) {
        if (file.type.startsWith('image/')) {
          const reader = new FileReader();

          reader.onload = (event) => {
            photos.push(event.target.result);
            loadedCount++;

            // When all photos are loaded, create containers
            if (loadedCount === totalFiles) {
              createPhotoContainers();
            }
          };

          reader.readAsDataURL(file);
        }
      }
    });

    function createPhotoContainers() {
      const photosSection = document.getElementById('photosSection');
      photosSection.innerHTML = '';

      photos.forEach((photoSrc, index) => {
        const photoContainer = document.createElement('div');
        photoContainer.className = 'photo-container';
        photoContainer.dataset.index = index;

        const img = document.createElement('img');
        img.src = photoSrc;
        img.alt = `Photo ${index + 1}`;

        photoContainer.appendChild(img);
        photosSection.appendChild(photoContainer);
      });

      // Show first photo
      if (photos.length > 0) {
        showPhoto(0);
      }
    }

    function showPhoto(index) {
      const containers = document.querySelectorAll('.photo-container');

      // Hide all photos
      containers.forEach(container => {
        container.classList.remove('active');
      });

      // Show current photo
      if (containers[index]) {
        containers[index].classList.add('active');
      }

      currentPhotoIndex = index;
    }

    function nextPhoto() {
      if (photos.length === 0) return;

      currentPhotoIndex = (currentPhotoIndex + 1) % photos.length;
      showPhoto(currentPhotoIndex);
    }

    function startSlideshow() {
      if (photos.length === 0) {
        alert('Please upload some photos first!');
        return;
      }

      isPlaying = true;
      const btn = document.getElementById('startStopBtn');
      const container = document.querySelector('.container');

      btn.textContent = 'â¸ï¸ Stop Slideshow';
      btn.classList.add('active');
      container.classList.add('slideshow-active');

      // Start the interval
      slideshowInterval = setInterval(nextPhoto, slideshowSpeed);
    }

    function stopSlideshow() {
      isPlaying = false;
      const btn = document.getElementById('startStopBtn');
      const container = document.querySelector('.container');

      btn.textContent = 'â–¶ï¸ Start Slideshow';
      btn.classList.remove('active');
      container.classList.remove('slideshow-active');

      // Clear the interval
      if (slideshowInterval) {
        clearInterval(slideshowInterval);
        slideshowInterval = null;
      }
    }

    // Start/Stop Button
    document.getElementById('startStopBtn').addEventListener('click', () => {
      if (isPlaying) {
        stopSlideshow();
      } else {
        startSlideshow();
      }
    });

    // Speed Control
    document.getElementById('speedControl').addEventListener('input', (e) => {
      slideshowSpeed = parseInt(e.target.value);
      const seconds = (slideshowSpeed / 1000).toFixed(1);
      document.getElementById('speedDisplay').textContent = seconds + 's';

      // Restart slideshow with new speed if it's playing
      if (isPlaying) {
        stopSlideshow();
        startSlideshow();
      }
    });

    // Drag and Drop Support
    const photoUpload = document.getElementById('photoUpload');

    // Prevent default drag behaviors on the whole page
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      document.body.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    // Highlight drop area when dragging over it
    ['dragenter', 'dragover'].forEach(eventName => {
      photoUpload.addEventListener(eventName, () => {
        photoUpload.classList.add('drag-over');
      }, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      photoUpload.addEventListener(eventName, () => {
        photoUpload.classList.remove('drag-over');
      }, false);
    });

    // Handle dropped files
    photoUpload.addEventListener('drop', (e) => {
      const dt = e.dataTransfer;
      const files = dt.files;
      handleFiles(files);
    }, false);

    // Handle pasted images (Cmd+V)
    document.addEventListener('paste', (e) => {
      const items = e.clipboardData.items;
      const files = [];

      for (let item of items) {
        if (item.type.startsWith('image/')) {
          files.push(item.getAsFile());
        }
      }

      if (files.length > 0) {
        handleFiles(files);
      }
    });

    // Unified file handling function
    function handleFiles(filesInput) {
      const photosSection = document.getElementById('photosSection');
      photosSection.innerHTML = '';
      photos = [];

      let loadedCount = 0;
      let totalFiles = 0;

      // Count valid image files
      for (let file of filesInput) {
        if (file && file.type.startsWith('image/')) {
          totalFiles++;
        }
      }

      if (totalFiles === 0) {
        photosSection.innerHTML = '<p style="color: #6c757d;">No valid images found. Please try again.</p>';
        return;
      }

      // Load all photos
      for (let file of filesInput) {
        if (file && file.type.startsWith('image/')) {
          const reader = new FileReader();

          reader.onload = (event) => {
            photos.push(event.target.result);
            loadedCount++;

            // When all photos are loaded, create containers
            if (loadedCount === totalFiles) {
              createPhotoContainers();
            }
          };

          reader.readAsDataURL(file);
        }
      }
    }

    // Initialize canvas background
    ctx.fillStyle = 'rgba(255, 255, 255, 0.05)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  </script>
</body>

</html>